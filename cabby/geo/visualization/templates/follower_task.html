{% extends "layout.html" %}

{% block content %}

<br>


<div class="float-container">
    <div class="float-child">
        <h3>Navigation Map</h3>

        <b>Map Instructions: </b>

        <ul>
            <li>You can zoom in and out by clicking on the +/- button.</li>
            <li>You can press and hold to move on the map.</li>

        </ul>


        
<div id="mapid" class=map></div>


    </div>
    <div class="float-child">
        <h3>Navigation Description</h3>
        <p><b>Your task </b>
            is to read the following navigation instructions and pin the goal on the map:
        </p>
        
        <p style="color:blue">{{ nav_instruction }}</p>

        <p>
            <b>Task Instructions: </b>
            <ul>
                <li>The green marker is the start point of the instructions.</li>
                <li>You can click on the map to pin a red marker for the goal.</li>
                <li>You can click on a different place on the map to move the goal.</li>
                <li>Once you finish click on the submit button.</li>
            </ul>
            

        <form method="POST" action="">
            <p><input type = "hidden" name = "latlng" id="latlng" /></p>
            <button type="submit" class="btn btn-primary" id="submit_button" name="submit_button" value="submit_b"> Submit and go to next task </button>

        </form>    
   

    </div>

</div>


<script>
    var start_point = {{start_point|tojson}}

    var lat = start_point[0]
    var lng = start_point[1]

    var southWest = L.latLng(lat-0.02, lng-0.02),
        northEast = L.latLng(lat+0.02, lng+0.02),
        bounds = L.latLngBounds(southWest, northEast);

    var map = L.map('mapid').setView(
        start_point, 
        16,
    ).setMaxBounds(
        bounds);


	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);


    var greenIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
        });

    var blackIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
        });


    var landmarks = {{landmarks|tojson}}


    for (var type in landmarks) {
        if (type=='start_point'){
            var icon = greenIcon
        } else{
            var icon = blackIcon
        }
        L.marker(
            landmarks[type][1], {icon: icon}).addTo(map).bindPopup(landmarks[type][0]);

    };

    
    var markers = new Array();

	function onMapClick(e) {
        if (markers.length > 0) {
              marker = markers.pop()
              map.removeLayer(marker)


        }


        
    
    var redIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
    });
    marker = new L.marker(e.latlng, {draggable:'true', icon: redIcon}).bindPopup('Goal');
    marker.on('dragend', function(event){
        var marker = event.target;
        var position = marker.getLatLng();
        marker.setLatLng(new L.LatLng(position.lat, position.lng),{draggable:'true'});
        map.panTo(new L.LatLng(position.lat, position.lng))
        });
    map.addLayer(marker);
    markers.push(marker);

    marker = markers.pop();
    markers.push(marker);
    var coords = marker.getLatLng();
    var lat = coords.lat.toString(10);
    var lng = coords.lng.toString(10);
    var data = JSON.stringify({lat: lat, lng: lng});

    document.getElementById('latlng').value = data

	}


	map.on('click', onMapClick);

    

</script>




{% endblock content %}